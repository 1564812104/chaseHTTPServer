# chaseHTTPServer

## 主要功能

- 浏览器访问8888端口 显示服务器上/home/dir下的所有文件和目录，点击访问相应资源
- 针对访问的不同资源 设置一个get_file_type函数来更改http响应头Content_type来改变类型
- 使用一个半同步/半反应堆线程池来增加并发

## 核心

 **Epoll、半同步/半反应堆线程池** 

- 在全局需要维护一个http_conn对象类型的数组，这个数组的意义是预先为每个可能的用户连接分配一个http_conn对象
- Epoll在主线程监听所有的连接（后来的全部都挂在这同一个Epoll监听树上）
- 主线程监听到可读事件时，会自己将来的数据写入程序读缓冲区；主线程监听到可写事件时，会将程序写缓冲区的数据写入到TCP写缓冲区（在这里前面定义的数组就起到了作用）
- 接上一步，针对监听到可读事件，将数据写入程序的读缓冲区后，会将此工作任务添加到线程池工作队列，线程池中会唤醒线程去解析来的请求（请求行、请求头部、请求内容（暂不处理））->判断访问的是目录还是文件->是文件就调用mmap函数搞一个文件映射->是目录就搞一个buf把遍历来的目录条目都写到buf里->添加响应头->将mmap映射的文件地址写入iovec（在本程序中使用writev）或把buf写到iovec中。又或者根据读的结果把当前socket关闭
- 接上上步，针对监听到可写事件，主线程将写缓冲区和iovec中的数据写过去，写完把mmap关了，并且根据是否keep-live来确定是重置默认值返回继续监听还是直接给这个文件描述符关了。